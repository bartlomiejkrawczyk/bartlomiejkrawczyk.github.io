---
type Props = Record<string, never>;
---

<script type="text/javascript" is:inline>
  const getThemePreference = () => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }

    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)",
    ).matches;
    return `purple-${prefersDark ? "dark" : "light"}`;
  };

  const storedTheme = getThemePreference();
  const [color, mode] = storedTheme.split("-");

  document.documentElement.className = `theme-${color} ${mode === "dark" ? "theme-dark" : ""}`;

  window.setTheme = function (
    color = "purple",
    mode = "light",
    reload = false,
    updateStorage = true,
  ) {
    // Add temporary transition class
    document.documentElement.classList.add("theme-transition");

    // Force browser to apply the class before changing the theme
    requestAnimationFrame(() => {
      document.documentElement.className = `theme-${color} ${mode === "dark" ? "theme-dark" : ""}`;

      if (updateStorage) {
        localStorage.setItem("theme", `${color}-${mode}`);
      }

      // Remove transition class after transition completes
      setTimeout(() => {
        document.documentElement.classList.remove("theme-transition");
      }, 1000); // must match CSS duration
    });

    if (reload) {
      window.location.reload();
    }
  };

  window.resetTheme = function () {
    const storedTheme = getThemePreference();
    const [color, mode] = storedTheme.split("-");
    document.documentElement.className = `theme-${color} ${mode === "dark" ? "theme-dark" : ""}`;
  };
</script>
