---
import { getCollection } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import type { LanguageKey } from "@i18n/ui";
import type { HTMLAttributes } from "astro/types";

const projects = await getCollection("projects").then((projects) =>
  projects.sort((a, b) => a.id.localeCompare(b.id)),
);

const lang = Astro.currentLocale as LanguageKey;

interface Props extends HTMLAttributes<"div"> {}

const { ...props } = Astro.props;
---

<div {...props}>
  <h2 class="pb-1">Projects</h2>
  <!-- https://docs.astro.build/en/guides/content-collections/#filtering-collection-queries -->
  <ul>
    {
      Object.entries(projects).map(([, project]) => (
        <li class="pt-1">
          <a href={getRelativeLocaleUrl(lang, "/projects/" + project.id)}>
            <span>
              <b>{project.data.title ?? project.id}</b>
            </span>
            <pre>{project.data.description}</pre>
          </a>
        </li>
      ))
    }
  </ul>

  <!-- 
  May configure pagination of projects: 
  https://docs.astro.build/en/guides/routing/#pagination 
  -->
</div>

<style>
  ul {
    display: grid;
    grid-auto-columns: 1fr;
    grid-auto-rows: 1fr;
    grid-template-columns: 1fr 1fr 1fr;
    margin: 0 auto;
    text-align: left;
  }

  li {
    display: inline-block;
    vertical-align: top;

    border-color: var(--gray-900);
    border-style: var(--tw-border-style);
    border-width: 1px;
    border-radius: var(--radius-lg);

    margin: var(--spacing);
    padding: var(--spacing);
  }
  pre {
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;
  }
</style>
